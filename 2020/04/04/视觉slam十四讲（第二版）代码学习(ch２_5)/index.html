<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.xml"};
  </script>

  <meta name="description" content="@TOC CMakeLists.txt常用语法： 单文件的情况：  123456789101112# 声明要求的 cmake 最低版本cmake_minimum_required( VERSION 2.8 )# 声明一个 cmake 工程project( HelloSLAM )# 设置编译模式#Release 模式生成的可执行文件小，但不能断点调试；Debug模式，正好相反set( CMAKE_B">
<meta property="og:type" content="article">
<meta property="og:title" content="视觉slam十四讲（第二版）代码学习(ch２_5)">
<meta property="og:url" content="http://yoursite.com/2020/04/04/%E8%A7%86%E8%A7%89slam%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%89%88%EF%BC%89%E4%BB%A3%E7%A0%81%E5%AD%A6%E4%B9%A0(ch%EF%BC%92_5)/index.html">
<meta property="og:site_name" content="求知若饥,虚心若愚。">
<meta property="og:description" content="@TOC CMakeLists.txt常用语法： 单文件的情况：  123456789101112# 声明要求的 cmake 最低版本cmake_minimum_required( VERSION 2.8 )# 声明一个 cmake 工程project( HelloSLAM )# 设置编译模式#Release 模式生成的可执行文件小，但不能断点调试；Debug模式，正好相反set( CMAKE_B">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-04-04T13:10:06.396Z">
<meta property="article:modified_time" content="2020-04-04T13:36:48.608Z">
<meta property="article:author" content="Jeff Tian">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/04/04/%E8%A7%86%E8%A7%89slam%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%89%88%EF%BC%89%E4%BB%A3%E7%A0%81%E5%AD%A6%E4%B9%A0(ch%EF%BC%92_5)/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>视觉slam十四讲（第二版）代码学习(ch２_5) | 求知若饥,虚心若愚。</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">求知若饥,虚心若愚。</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="search-pop-overlay">
  <div class="popup search-popup">
      <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

  </div>
</div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/04/%E8%A7%86%E8%A7%89slam%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%89%88%EF%BC%89%E4%BB%A3%E7%A0%81%E5%AD%A6%E4%B9%A0(ch%EF%BC%92_5)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jeff Tian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="求知若饥,虚心若愚。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          视觉slam十四讲（第二版）代码学习(ch２_5)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-04 21:10:06 / Modified: 21:36:48" itemprop="dateCreated datePublished" datetime="2020-04-04T21:10:06+08:00">2020-04-04</time>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>@<a href="目录">TOC</a></p>
<h1 id="CMakeLists-txt常用语法："><a href="#CMakeLists-txt常用语法：" class="headerlink" title="CMakeLists.txt常用语法："></a>CMakeLists.txt常用语法：</h1><ul>
<li>单文件的情况：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明要求的 cmake 最低版本</span></span><br><span class="line">cmake_minimum_required( VERSION 2.8 )</span><br><span class="line"><span class="comment"># 声明一个 cmake 工程</span></span><br><span class="line">project( HelloSLAM )</span><br><span class="line"><span class="comment"># 设置编译模式</span></span><br><span class="line"><span class="comment">#Release 模式生成的可执行文件小，但不能断点调试；Debug模式，正好相反</span></span><br><span class="line"><span class="built_in">set</span>( CMAKE_BUILD_TYPE <span class="string">"Debug"</span> )　</span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_FLAGS <span class="string">"-std=c++11"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把main函数文件　编译为可执行文件</span></span><br><span class="line"><span class="comment"># 如果是分文件编写的话，把.h和.cpp都写在括号里就行了</span></span><br><span class="line">add_executable( useHello useHello.cpp )</span><br></pre></td></tr></table></figure>
<ul>
<li>需要自己写一个库的情况：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个共享库文件 libhello.so</span></span><br><span class="line"><span class="comment">#这个库的头文件是在main文件中包含的：＃include"libHelloSLAM.h"</span></span><br><span class="line">add_library( hello SHARED libHelloSLAM.cpp ) </span><br><span class="line"><span class="comment"># 把main函数文件　编译为可执行文件</span></span><br><span class="line">add_executable( useHello useHello.cpp )</span><br><span class="line"><span class="comment"># 把可执行文件和库文件连接起来</span></span><br><span class="line">target_link_libraries( useHello hello )</span><br></pre></td></tr></table></figure></li>
<li>使用第三方库的情况：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果知道第三方库的位置，可以直接包含其绝对路径，以简便ｃｐｐ文件中的＃ｉｎｃｌｕｄｅ“”</span></span><br><span class="line"><span class="comment"># 添加Eigen头文件</span></span><br><span class="line">include_directories( <span class="string">"/usr/include/eigen3"</span> )</span><br><span class="line"><span class="comment">#------------------------------------------------------</span></span><br><span class="line"><span class="comment">#find_package 命令是 cmake 提供的寻找某个库的头文件与库文件的指令。如果 cmake能够找到它，就会提供头文件和库文件所在的目录的变量。</span></span><br><span class="line"><span class="comment"># 添加Pangolin依赖</span></span><br><span class="line">find_package( Pangolin )</span><br><span class="line">include_directories( <span class="variable">$&#123;Pangolin_INCLUDE_DIRS&#125;</span> )</span><br><span class="line">add_executable( visualizeGeometry visualizeGeometry.cpp )</span><br><span class="line">target_link_libraries( visualizeGeometry <span class="variable">$&#123;Pangolin_LIBRARIES&#125;</span> )</span><br><span class="line"><span class="comment">#-----------------------------------------------------</span></span><br><span class="line"><span class="comment"># 在 Sophus 这个例子中，就是Sophus_INCLUDE_DIRS 和 Sophus_LIBRARIES 这两个变量。根据它们，我们就能将Sophus 库引入自己的 cmake 工程了。</span></span><br><span class="line">find_package( Sophus REQUIRED )</span><br><span class="line">include_directories( <span class="variable">$&#123;Sophus_INCLUDE_DIRS&#125;</span> )</span><br><span class="line">add_executable( useSophus useSophus.cpp )</span><br><span class="line">target_link_libraries( useSophus <span class="variable">$&#123;Sophus_LIBRARIES&#125;</span> )</span><br></pre></td></tr></table></figure>
<code>find_package()</code>分为module模式（基础模式）、config模式（高级模式）。</li>
</ul>
<p>module模式中的关键字：</p>
<p><code>version</code>和<code>EXACT</code> 都是可选的，version指定的是版本，如果指定就必须检查找到的包的版本是否和version兼容。如果指定EXACT则表示必须完全匹配的版本而不是兼容版本就可以。</p>
<p><code>QUIET</code> 可选字段，表示如果查找失败，不会在屏幕进行输出（但是如果指定了REQUIRED字段，则QUIET无效，仍然会输出查找失败提示语）。</p>
<p><code>MODULE</code> 可选字段。前面提到说“如果Module模式查找失败则回退到Config模式进行查找”，但是假如设定了MODULE选项，那么就只在Module模式查找，如果Module模式下查找失败并不回落到Config模式查找。</p>
<p><code>REQUIRED</code>可选字段。表示一定要找到包，找不到的话就立即停掉整个cmake。而如果不指定REQUIRED则cmake会继续执行。</p>
<p><code>COMPONENTS</code>，<code>components</code>:可选字段，表示查找的包中必须要找到的组件(components），如果有任何一个找不到就算失败，类似于REQUIRED，导致cmake停止执行。</p>
<p><code>OPTIONAL_COMPONENTS</code>：可选的模块，找不到也不会让cmake停止执行。</p>
<h1 id="初识SLAM"><a href="#初识SLAM" class="headerlink" title="初识SLAM"></a>初识SLAM</h1><h2 id="g-的使用"><a href="#g-的使用" class="headerlink" title="g++的使用"></a>g++的使用</h2><p>安装g++:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install g++</span><br></pre></td></tr></table></figure>

<p>使用g++编译cpp程序，生成可执行文件a.out ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ helloSLAM.cpp -o a.out</span><br><span class="line">./a.out  <span class="comment">#执行　a.out</span></span><br></pre></td></tr></table></figure>
<h2 id="cmake的使用方法："><a href="#cmake的使用方法：" class="headerlink" title="cmake的使用方法："></a>cmake的使用方法：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir build</span><br><span class="line">$ <span class="built_in">cd</span> build</span><br><span class="line">$ cmake ..</span><br><span class="line">$ make</span><br></pre></td></tr></table></figure>

<h1 id="三维空间刚体运动"><a href="#三维空间刚体运动" class="headerlink" title="三维空间刚体运动"></a>三维空间刚体运动</h1><p>Eigen是一个 C++ 开源线性代数库。安装eigen:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install libeigen3-dev</span><br></pre></td></tr></table></figure>

<p>它的默认位置在<code>/usr/include/eigen3/</code>中。如果你不确定，可以输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo updatedb</span><br><span class="line">$ locate eigen</span><br></pre></td></tr></table></figure>
<p>来查找它的位置。</p>
<h2 id="eigenMatrix"><a href="#eigenMatrix" class="headerlink" title="eigenMatrix"></a>eigenMatrix</h2><p>这个例程演示了 Eigen 矩阵的基本操作与运算。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="comment">// Eigen 核心部分</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="comment">// 稠密矩阵的代数运算（逆，特征值等）</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Dense&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MATRIX_SIZE 50</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************</span></span><br><span class="line"><span class="comment">* 本程序演示了 Eigen 基本类型的使用</span></span><br><span class="line"><span class="comment">****************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Eigen 中所有向量和矩阵都是Eigen::Matrix，它是一个模板类。它的前三个参数为：数据类型，行，列</span></span><br><span class="line">  <span class="comment">// 声明一个2*3的float矩阵</span></span><br><span class="line">  Matrix&lt;<span class="keyword">float</span>, <span class="number">2</span>, <span class="number">3</span>&gt; matrix_23;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 同时，Eigen 通过 typedef 提供了许多内置类型，不过底层仍是Eigen::Matrix</span></span><br><span class="line">  <span class="comment">// 例如 Vector3d 实质上是 Eigen::Matrix&lt;double, 3, 1&gt;，即三维向量</span></span><br><span class="line">  Vector3d v_3d;</span><br><span class="line">  <span class="comment">// 这是一样的</span></span><br><span class="line">  Matrix&lt;<span class="keyword">float</span>, <span class="number">3</span>, <span class="number">1</span>&gt; vd_3d;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Matrix3d 实质上是 Eigen::Matrix&lt;double, 3, 3&gt;</span></span><br><span class="line">  Matrix3d matrix_33 = Matrix3d::Zero(); <span class="comment">//初始化为零</span></span><br><span class="line">  <span class="comment">// 如果不确定矩阵大小，可以使用动态大小的矩阵</span></span><br><span class="line">  Matrix&lt;<span class="keyword">double</span>, Dynamic, Dynamic&gt; matrix_dynamic;</span><br><span class="line">  <span class="comment">// 更简单的</span></span><br><span class="line">  MatrixXd matrix_x;</span><br><span class="line">  <span class="comment">// 这种类型还有很多，我们不一一列举</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下面是对Eigen阵的操作</span></span><br><span class="line">  <span class="comment">// 输入数据（初始化）</span></span><br><span class="line">  matrix_23 &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>;</span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"matrix 2x3 from 1 to 6: \n"</span> &lt;&lt; matrix_23 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用()访问矩阵中的元素</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"print matrix 2x3: "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) <span class="built_in">cout</span> &lt;&lt; matrix_23(i, j) &lt;&lt; <span class="string">"\t"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 矩阵和向量相乘（实际上仍是矩阵和矩阵）</span></span><br><span class="line">  v_3d &lt;&lt; <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>;</span><br><span class="line">  vd_3d &lt;&lt; <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 但是在Eigen里你不能混合两种不同类型的矩阵，像这样是错的</span></span><br><span class="line">  <span class="comment">// Matrix&lt;double, 2, 1&gt; result_wrong_type = matrix_23 * v_3d;</span></span><br><span class="line">  <span class="comment">// 应该显式转换</span></span><br><span class="line">  Matrix&lt;<span class="keyword">double</span>, <span class="number">2</span>, <span class="number">1</span>&gt; result = matrix_23.cast&lt;<span class="keyword">double</span>&gt;() * v_3d;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"[1,2,3;4,5,6]*[3,2,1]="</span> &lt;&lt; result.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  Matrix&lt;<span class="keyword">float</span>, <span class="number">2</span>, <span class="number">1</span>&gt; result2 = matrix_23 * vd_3d;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"[1,2,3;4,5,6]*[4,5,6]: "</span> &lt;&lt; result2.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 同样你不能搞错矩阵的维度</span></span><br><span class="line">  <span class="comment">// 试着取消下面的注释，看看Eigen会报什么错</span></span><br><span class="line">  <span class="comment">// Eigen::Matrix&lt;double, 2, 3&gt; result_wrong_dimension = matrix_23.cast&lt;double&gt;() * v_3d;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一些矩阵运算</span></span><br><span class="line">  <span class="comment">// 四则运算就不演示了，直接用+-*/即可。</span></span><br><span class="line">  matrix_33 = Matrix3d::Random();      <span class="comment">// 随机数矩阵</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"random matrix: \n"</span> &lt;&lt; matrix_33 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"transpose: \n"</span> &lt;&lt; matrix_33.transpose() &lt;&lt; <span class="built_in">endl</span>;      <span class="comment">// 转置</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"sum: "</span> &lt;&lt; matrix_33.sum() &lt;&lt; <span class="built_in">endl</span>;            <span class="comment">// 各元素和</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"trace: "</span> &lt;&lt; matrix_33.trace() &lt;&lt; <span class="built_in">endl</span>;          <span class="comment">// 迹</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"times 10: \n"</span> &lt;&lt; <span class="number">10</span> * matrix_33 &lt;&lt; <span class="built_in">endl</span>;               <span class="comment">// 数乘</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"inverse: \n"</span> &lt;&lt; matrix_33.inverse() &lt;&lt; <span class="built_in">endl</span>;        <span class="comment">// 逆</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"det: "</span> &lt;&lt; matrix_33.determinant() &lt;&lt; <span class="built_in">endl</span>;    <span class="comment">// 行列式</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 特征值</span></span><br><span class="line">  <span class="comment">// 实对称矩阵可以保证对角化成功</span></span><br><span class="line">  <span class="function">SelfAdjointEigenSolver&lt;Matrix3d&gt; <span class="title">eigen_solver</span><span class="params">(matrix_33.transpose() * matrix_33)</span></span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"Eigen values = \n"</span> &lt;&lt; eigen_solver.eigenvalues() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"Eigen vectors = \n"</span> &lt;&lt; eigen_solver.eigenvectors() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 解方程</span></span><br><span class="line">  <span class="comment">// 我们求解 matrix_NN * x = v_Nd 这个方程</span></span><br><span class="line">  <span class="comment">// N的大小在前边的宏里定义，它由随机数生成</span></span><br><span class="line">  <span class="comment">// 直接求逆自然是最直接的，但是求逆运算量大</span></span><br><span class="line"></span><br><span class="line">  Matrix&lt;<span class="keyword">double</span>, MATRIX_SIZE, MATRIX_SIZE&gt; matrix_NN</span><br><span class="line">      = MatrixXd::Random(MATRIX_SIZE, MATRIX_SIZE);</span><br><span class="line">  matrix_NN = matrix_NN * matrix_NN.transpose();  <span class="comment">// 保证半正定</span></span><br><span class="line">  Matrix&lt;<span class="keyword">double</span>, MATRIX_SIZE, <span class="number">1</span>&gt; v_Nd = MatrixXd::Random(MATRIX_SIZE, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">clock_t</span> time_stt = clock(); <span class="comment">// 计时</span></span><br><span class="line">  <span class="comment">// 直接求逆</span></span><br><span class="line">  Matrix&lt;<span class="keyword">double</span>, MATRIX_SIZE, <span class="number">1</span>&gt; x = matrix_NN.inverse() * v_Nd;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"time of normal inverse is "</span></span><br><span class="line">       &lt;&lt; <span class="number">1000</span> * (clock() - time_stt) / (<span class="keyword">double</span>) CLOCKS_PER_SEC &lt;&lt; <span class="string">"ms"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"x = "</span> &lt;&lt; x.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通常用矩阵分解来求，例如QR分解，速度会快很多</span></span><br><span class="line">  time_stt = clock();</span><br><span class="line">  x = matrix_NN.colPivHouseholderQr().solve(v_Nd);</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"time of Qr decomposition is "</span></span><br><span class="line">       &lt;&lt; <span class="number">1000</span> * (clock() - time_stt) / (<span class="keyword">double</span>) CLOCKS_PER_SEC &lt;&lt; <span class="string">"ms"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"x = "</span> &lt;&lt; x.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对于正定矩阵，还可以用cholesky分解来解方程</span></span><br><span class="line">  time_stt = clock();</span><br><span class="line">  x = matrix_NN.ldlt().solve(v_Nd);</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"time of ldlt decomposition is "</span></span><br><span class="line">       &lt;&lt; <span class="number">1000</span> * (clock() - time_stt) / (<span class="keyword">double</span>) CLOCKS_PER_SEC &lt;&lt; <span class="string">"ms"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"x = "</span> &lt;&lt; x.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="eigenGeometry"><a href="#eigenGeometry" class="headerlink" title="eigenGeometry"></a>eigenGeometry</h2><p>本程序演示了 Eigen 几何模块的使用方法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Geometry&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 本程序演示了 Eigen 几何模块的使用方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Eigen/Geometry 模块提供了各种旋转和平移的表示</span></span><br><span class="line">  <span class="comment">// 3D 旋转矩阵直接使用 Matrix3d 或 Matrix3f</span></span><br><span class="line">  Matrix3d rotation_matrix = Matrix3d::Identity();</span><br><span class="line">  <span class="comment">// 旋转向量使用 AngleAxis, 它底层不直接是Matrix，但运算可以当作矩阵（因为重载了运算符）</span></span><br><span class="line">  <span class="function">AngleAxisd <span class="title">rotation_vector</span><span class="params">(M_PI / <span class="number">4</span>, Vector3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>))</span></span>;     <span class="comment">//沿 Z 轴旋转 45 度</span></span><br><span class="line">  <span class="built_in">cout</span>.precision(<span class="number">3</span>);</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"rotation matrix =\n"</span> &lt;&lt; rotation_vector.matrix() &lt;&lt; <span class="built_in">endl</span>;   <span class="comment">//用matrix()转换成矩阵</span></span><br><span class="line">  <span class="comment">// 也可以直接赋值</span></span><br><span class="line">  rotation_matrix = rotation_vector.toRotationMatrix();</span><br><span class="line">  <span class="comment">// 用 AngleAxis 可以进行坐标变换</span></span><br><span class="line">  <span class="function">Vector3d <span class="title">v</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">  Vector3d v_rotated = rotation_vector * v;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"(1,0,0) after rotation (by angle axis) = "</span> &lt;&lt; v_rotated.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// 或者用旋转矩阵</span></span><br><span class="line">  v_rotated = rotation_matrix * v;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"(1,0,0) after rotation (by matrix) = "</span> &lt;&lt; v_rotated.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 欧拉角: 可以将旋转矩阵直接转换成欧拉角</span></span><br><span class="line">  Vector3d euler_angles = rotation_matrix.eulerAngles(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>); <span class="comment">// ZYX顺序，即roll pitch yaw顺序</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"yaw pitch roll = "</span> &lt;&lt; euler_angles.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 欧氏变换矩阵使用 Eigen::Isometry</span></span><br><span class="line">  Isometry3d T = Isometry3d::Identity();                <span class="comment">// 虽然称为3d，实质上是4＊4的矩阵</span></span><br><span class="line">  T.rotate(rotation_vector);                                     <span class="comment">// 按照rotation_vector进行旋转</span></span><br><span class="line">  T.pretranslate(Vector3d(<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>));                     <span class="comment">// 把平移向量设成(1,3,4)</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"Transform matrix = \n"</span> &lt;&lt; T.matrix() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用变换矩阵进行坐标变换</span></span><br><span class="line">  Vector3d v_transformed = T * v;                              <span class="comment">// 相当于R*v+t</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"v tranformed = "</span> &lt;&lt; v_transformed.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对于仿射和射影变换，使用 Eigen::Affine3d 和 Eigen::Projective3d 即可，略</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 四元数</span></span><br><span class="line">  <span class="comment">// 可以直接把AngleAxis赋值给四元数，反之亦然</span></span><br><span class="line">  Quaterniond q = Quaterniond(rotation_vector);</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"quaternion from rotation vector = "</span> &lt;&lt; q.coeffs().transpose()</span><br><span class="line">       &lt;&lt; <span class="built_in">endl</span>;   <span class="comment">// 请注意coeffs的顺序是(x,y,z,w),w为实部，前三者为虚部</span></span><br><span class="line">  <span class="comment">// 也可以把旋转矩阵赋给它</span></span><br><span class="line">  q = Quaterniond(rotation_matrix);</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"quaternion from rotation matrix = "</span> &lt;&lt; q.coeffs().transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// 使用四元数旋转一个向量，使用重载的乘法即可</span></span><br><span class="line">  v_rotated = q * v; <span class="comment">// 注意数学上是qvq^&#123;-1&#125;</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"(1,0,0) after rotation = "</span> &lt;&lt; v_rotated.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// 用常规向量乘法表示，则应该如下计算</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"should be equal to "</span> &lt;&lt; (q * Quaterniond(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>) * q.inverse()).coeffs().transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="visualizeGeometry"><a href="#visualizeGeometry" class="headerlink" title="visualizeGeometry"></a>visualizeGeometry</h2><p>通过一个窗口展示数据变化</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Geometry&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pangolin/pangolin.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RotationMatrix</span> &#123;</span></span><br><span class="line">  Matrix3d matrix = Matrix3d::Identity();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, <span class="keyword">const</span> RotationMatrix &amp;r) &#123;</span><br><span class="line">  out.setf(ios::fixed);</span><br><span class="line">  Matrix3d matrix = r.matrix;</span><br><span class="line">  out &lt;&lt; <span class="string">'='</span>;</span><br><span class="line">  out &lt;&lt; <span class="string">"["</span> &lt;&lt; setprecision(<span class="number">2</span>) &lt;&lt; matrix(<span class="number">0</span>, <span class="number">0</span>) &lt;&lt; <span class="string">","</span> &lt;&lt; matrix(<span class="number">0</span>, <span class="number">1</span>) &lt;&lt; <span class="string">","</span> &lt;&lt; matrix(<span class="number">0</span>, <span class="number">2</span>) &lt;&lt; <span class="string">"],"</span></span><br><span class="line">      &lt;&lt; <span class="string">"["</span> &lt;&lt; matrix(<span class="number">1</span>, <span class="number">0</span>) &lt;&lt; <span class="string">","</span> &lt;&lt; matrix(<span class="number">1</span>, <span class="number">1</span>) &lt;&lt; <span class="string">","</span> &lt;&lt; matrix(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; <span class="string">"],"</span></span><br><span class="line">      &lt;&lt; <span class="string">"["</span> &lt;&lt; matrix(<span class="number">2</span>, <span class="number">0</span>) &lt;&lt; <span class="string">","</span> &lt;&lt; matrix(<span class="number">2</span>, <span class="number">1</span>) &lt;&lt; <span class="string">","</span> &lt;&lt; matrix(<span class="number">2</span>, <span class="number">2</span>) &lt;&lt; <span class="string">"]"</span>;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">istream &amp;<span class="keyword">operator</span>&gt;&gt;(istream &amp;in, RotationMatrix &amp;r) &#123;</span><br><span class="line">  <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TranslationVector</span> &#123;</span></span><br><span class="line">  Vector3d trans = Vector3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, <span class="keyword">const</span> TranslationVector &amp;t) &#123;</span><br><span class="line">  out &lt;&lt; <span class="string">"=["</span> &lt;&lt; t.trans(<span class="number">0</span>) &lt;&lt; <span class="string">','</span> &lt;&lt; t.trans(<span class="number">1</span>) &lt;&lt; <span class="string">','</span> &lt;&lt; t.trans(<span class="number">2</span>) &lt;&lt; <span class="string">"]"</span>;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">istream &amp;<span class="keyword">operator</span>&gt;&gt;(istream &amp;in, TranslationVector &amp;t) &#123;</span><br><span class="line">  <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">QuaternionDraw</span> &#123;</span></span><br><span class="line">  Quaterniond q;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, <span class="keyword">const</span> QuaternionDraw quat) &#123;</span><br><span class="line">  <span class="keyword">auto</span> c = quat.q.coeffs();</span><br><span class="line">  out &lt;&lt; <span class="string">"=["</span> &lt;&lt; c[<span class="number">0</span>] &lt;&lt; <span class="string">","</span> &lt;&lt; c[<span class="number">1</span>] &lt;&lt; <span class="string">","</span> &lt;&lt; c[<span class="number">2</span>] &lt;&lt; <span class="string">","</span> &lt;&lt; c[<span class="number">3</span>] &lt;&lt; <span class="string">"]"</span>;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">istream &amp;<span class="keyword">operator</span>&gt;&gt;(istream &amp;in, <span class="keyword">const</span> QuaternionDraw quat) &#123;</span><br><span class="line">  <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  pangolin::CreateWindowAndBind(<span class="string">"visualize geometry"</span>, <span class="number">1000</span>, <span class="number">600</span>);</span><br><span class="line">  glEnable(GL_DEPTH_TEST);</span><br><span class="line">  <span class="function">pangolin::OpenGlRenderState <span class="title">s_cam</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    pangolin::ProjectionMatrix(<span class="number">1000</span>, <span class="number">600</span>, <span class="number">420</span>, <span class="number">420</span>, <span class="number">500</span>, <span class="number">300</span>, <span class="number">0.1</span>, <span class="number">1000</span>),</span></span></span><br><span class="line"><span class="function"><span class="params">    pangolin::ModelViewLookAt(<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, pangolin::AxisY)</span></span></span><br><span class="line"><span class="function"><span class="params">  )</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> UI_WIDTH = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">  pangolin::View &amp;d_cam = pangolin::CreateDisplay().</span><br><span class="line">    SetBounds(<span class="number">0.0</span>, <span class="number">1.0</span>, pangolin::Attach::Pix(UI_WIDTH), <span class="number">1.0</span>, <span class="number">-1000.0f</span> / <span class="number">600.0f</span>).</span><br><span class="line">    SetHandler(<span class="keyword">new</span> pangolin::Handler3D(s_cam));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ui</span></span><br><span class="line">  <span class="function">pangolin::Var&lt;RotationMatrix&gt; <span class="title">rotation_matrix</span><span class="params">(<span class="string">"ui.R"</span>, RotationMatrix())</span></span>;</span><br><span class="line">  <span class="function">pangolin::Var&lt;TranslationVector&gt; <span class="title">translation_vector</span><span class="params">(<span class="string">"ui.t"</span>, TranslationVector())</span></span>;</span><br><span class="line">  <span class="function">pangolin::Var&lt;TranslationVector&gt; <span class="title">euler_angles</span><span class="params">(<span class="string">"ui.rpy"</span>, TranslationVector())</span></span>;</span><br><span class="line">  <span class="function">pangolin::Var&lt;QuaternionDraw&gt; <span class="title">quaternion</span><span class="params">(<span class="string">"ui.q"</span>, QuaternionDraw())</span></span>;</span><br><span class="line">  pangolin::CreatePanel(<span class="string">"ui"</span>).SetBounds(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, pangolin::Attach::Pix(UI_WIDTH));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!pangolin::ShouldQuit()) &#123;</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    d_cam.Activate(s_cam);</span><br><span class="line"></span><br><span class="line">    pangolin::OpenGlMatrix matrix = s_cam.GetModelViewMatrix();</span><br><span class="line">    Matrix&lt;<span class="keyword">double</span>, <span class="number">4</span>, <span class="number">4</span>&gt; m = matrix;</span><br><span class="line"></span><br><span class="line">    RotationMatrix R;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        R.matrix(i, j) = m(j, i);</span><br><span class="line">    rotation_matrix = R;</span><br><span class="line"></span><br><span class="line">    TranslationVector t;</span><br><span class="line">    t.trans = Vector3d(m(<span class="number">0</span>, <span class="number">3</span>), m(<span class="number">1</span>, <span class="number">3</span>), m(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">    t.trans = -R.matrix * t.trans;</span><br><span class="line">    translation_vector = t;</span><br><span class="line"></span><br><span class="line">    TranslationVector euler;</span><br><span class="line">    euler.trans = R.matrix.eulerAngles(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    euler_angles = euler;</span><br><span class="line"></span><br><span class="line">    QuaternionDraw quat;</span><br><span class="line">    quat.q = Quaterniond(R.matrix);</span><br><span class="line">    quaternion = quat;</span><br><span class="line"></span><br><span class="line">    glColor3f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">    pangolin::glDrawColouredCube();</span><br><span class="line">    <span class="comment">// draw the original axis</span></span><br><span class="line">    glLineWidth(<span class="number">3</span>);</span><br><span class="line">    glColor3f(<span class="number">0.8f</span>, <span class="number">0.f</span>, <span class="number">0.f</span>);</span><br><span class="line">    glBegin(GL_LINES);</span><br><span class="line">    glVertex3f(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    glVertex3f(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    glColor3f(<span class="number">0.f</span>, <span class="number">0.8f</span>, <span class="number">0.f</span>);</span><br><span class="line">    glVertex3f(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    glVertex3f(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">    glColor3f(<span class="number">0.2f</span>, <span class="number">0.2f</span>, <span class="number">1.f</span>);</span><br><span class="line">    glVertex3f(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    glVertex3f(<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">    glEnd();</span><br><span class="line"></span><br><span class="line">    pangolin::FinishFrame();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="coordinaeTransform"><a href="#coordinaeTransform" class="headerlink" title="coordinaeTransform"></a>coordinaeTransform</h2><p>点在不同坐标系间的转换</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Geometry&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  Quaterniond q1(0.35, 0.2, 0.3, 0.1), q2(-0.5, 0.4, -0.1, 0.2);</span><br><span class="line">  q1.normalize();</span><br><span class="line">  q2.normalize();</span><br><span class="line">  Vector3d t1(0.3, 0.1, 0.1), t2(-0.1, 0.5, 0.3);</span><br><span class="line">  <span class="function">Vector3d <span class="title">p1</span><span class="params">(<span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0.2</span>)</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//用四元数ｑ和平移向量ｔ初始化变换矩阵Ｔ</span></span><br><span class="line">  Isometry3d T1w(q1), T2w(q2);</span><br><span class="line">  T1w.pretranslate(t1);</span><br><span class="line">  T2w.pretranslate(t2);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//p1乘T1w的逆是把p1转换到世界坐标系，再乘Ｔ２ｗ，即转换到T2w坐标系</span></span><br><span class="line">  Vector3d p2 = T2w * T1w.inverse() * p1; </span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; p2.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="plotTrajectory"><a href="#plotTrajectory" class="headerlink" title="plotTrajectory"></a>plotTrajectory</h2><p>本例演示了如何画出一个预先存储的轨迹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pangolin/pangolin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 本例演示了如何画出一个预先存储的轨迹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="comment">// path to trajectory file</span></span><br><span class="line"><span class="built_in">string</span> trajectory_file = <span class="string">"../trajectory.txt"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DrawTrajectory</span><span class="params">(<span class="built_in">vector</span>&lt;Isometry3d, Eigen::aligned_allocator&lt;Isometry3d&gt;&gt;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">vector</span>&lt;Isometry3d, Eigen::aligned_allocator&lt;Isometry3d&gt; &gt; poses;</span><br><span class="line">  <span class="function">ifstream <span class="title">fin</span><span class="params">(trajectory_file)</span></span>;</span><br><span class="line">  <span class="keyword">if</span> (!fin) &#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"cannot find trajectory file at "</span> &lt;&lt; trajectory_file &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!fin.eof()) &#123;</span><br><span class="line">    <span class="keyword">double</span> time, tx, ty, tz, qx, qy, qz, qw;</span><br><span class="line">    fin &gt;&gt; time &gt;&gt; tx &gt;&gt; ty &gt;&gt; tz &gt;&gt; qx &gt;&gt; qy &gt;&gt; qz &gt;&gt; qw;</span><br><span class="line">    <span class="function">Isometry3d <span class="title">Twr</span><span class="params">(Quaterniond(qw, qx, qy, qz))</span></span>;</span><br><span class="line">    Twr.pretranslate(Vector3d(tx, ty, tz));</span><br><span class="line">    poses.push_back(Twr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"read total "</span> &lt;&lt; poses.size() &lt;&lt; <span class="string">" pose entries"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// draw trajectory in pangolin</span></span><br><span class="line">  DrawTrajectory(poses);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DrawTrajectory</span><span class="params">(<span class="built_in">vector</span>&lt;Isometry3d, Eigen::aligned_allocator&lt;Isometry3d&gt;&gt; poses)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// create pangolin window and plot the trajectory</span></span><br><span class="line">  pangolin::CreateWindowAndBind(<span class="string">"Trajectory Viewer"</span>, <span class="number">1024</span>, <span class="number">768</span>);</span><br><span class="line">  glEnable(GL_DEPTH_TEST);</span><br><span class="line">  glEnable(GL_BLEND);</span><br><span class="line">  glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">  <span class="function">pangolin::OpenGlRenderState <span class="title">s_cam</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    pangolin::ProjectionMatrix(<span class="number">1024</span>, <span class="number">768</span>, <span class="number">500</span>, <span class="number">500</span>, <span class="number">512</span>, <span class="number">389</span>, <span class="number">0.1</span>, <span class="number">1000</span>),</span></span></span><br><span class="line"><span class="function"><span class="params">    pangolin::ModelViewLookAt(<span class="number">0</span>, <span class="number">-0.1</span>, <span class="number">-1.8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  )</span></span>;</span><br><span class="line"></span><br><span class="line">  pangolin::View &amp;d_cam = pangolin::CreateDisplay()</span><br><span class="line">    .SetBounds(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">-1024.0f</span> / <span class="number">768.0f</span>)</span><br><span class="line">    .SetHandler(<span class="keyword">new</span> pangolin::Handler3D(s_cam));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (pangolin::ShouldQuit() == <span class="literal">false</span>) &#123;</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    d_cam.Activate(s_cam);</span><br><span class="line">    glClearColor(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    glLineWidth(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; poses.size(); i++) &#123;</span><br><span class="line">      <span class="comment">// 画每个位姿的三个坐标轴</span></span><br><span class="line">      Vector3d Ow = poses[i].translation();</span><br><span class="line">      Vector3d Xw = poses[i] * (<span class="number">0.1</span> * Vector3d(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">      Vector3d Yw = poses[i] * (<span class="number">0.1</span> * Vector3d(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">      Vector3d Zw = poses[i] * (<span class="number">0.1</span> * Vector3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">      glBegin(GL_LINES);</span><br><span class="line">      glColor3f(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">      glVertex3d(Ow[<span class="number">0</span>], Ow[<span class="number">1</span>], Ow[<span class="number">2</span>]);</span><br><span class="line">      glVertex3d(Xw[<span class="number">0</span>], Xw[<span class="number">1</span>], Xw[<span class="number">2</span>]);</span><br><span class="line">      glColor3f(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">      glVertex3d(Ow[<span class="number">0</span>], Ow[<span class="number">1</span>], Ow[<span class="number">2</span>]);</span><br><span class="line">      glVertex3d(Yw[<span class="number">0</span>], Yw[<span class="number">1</span>], Yw[<span class="number">2</span>]);</span><br><span class="line">      glColor3f(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">      glVertex3d(Ow[<span class="number">0</span>], Ow[<span class="number">1</span>], Ow[<span class="number">2</span>]);</span><br><span class="line">      glVertex3d(Zw[<span class="number">0</span>], Zw[<span class="number">1</span>], Zw[<span class="number">2</span>]);</span><br><span class="line">      glEnd();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 画出连线</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; poses.size(); i++) &#123;</span><br><span class="line">      glColor3f(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">      glBegin(GL_LINES);</span><br><span class="line">      <span class="keyword">auto</span> p1 = poses[i], p2 = poses[i + <span class="number">1</span>];</span><br><span class="line">      glVertex3d(p1.translation()[<span class="number">0</span>], p1.translation()[<span class="number">1</span>], p1.translation()[<span class="number">2</span>]);</span><br><span class="line">      glVertex3d(p2.translation()[<span class="number">0</span>], p2.translation()[<span class="number">1</span>], p2.translation()[<span class="number">2</span>]);</span><br><span class="line">      glEnd();</span><br><span class="line">    &#125;</span><br><span class="line">    pangolin::FinishFrame();</span><br><span class="line">    usleep(<span class="number">5000</span>);   <span class="comment">// sleep 5 ms</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="李群、李代数"><a href="#李群、李代数" class="headerlink" title="李群、李代数"></a>李群、李代数</h1><h2 id="useSophus"><a href="#useSophus" class="headerlink" title="useSophus"></a>useSophus</h2><p>本程序演示sophus的基本用法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Geometry&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sophus/se3.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 本程序演示sophus的基本用法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 沿Z轴转90度的旋转矩阵</span></span><br><span class="line">  Matrix3d R = AngleAxisd(M_PI / <span class="number">2</span>, Vector3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)).toRotationMatrix();</span><br><span class="line">  <span class="comment">// 或者四元数</span></span><br><span class="line">  <span class="function">Quaterniond <span class="title">q</span><span class="params">(R)</span></span>;</span><br><span class="line">  <span class="function">Sophus::SO3d <span class="title">SO3_R</span><span class="params">(R)</span></span>;              <span class="comment">// Sophus::SO3d可以直接从旋转矩阵构造</span></span><br><span class="line">  <span class="function">Sophus::SO3d <span class="title">SO3_q</span><span class="params">(q)</span></span>;              <span class="comment">// 也可以通过四元数构造</span></span><br><span class="line">  <span class="comment">// 二者是等价的</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"SO(3) from matrix:\n"</span> &lt;&lt; SO3_R.matrix() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"SO(3) from quaternion:\n"</span> &lt;&lt; SO3_q.matrix() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"they are equal"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用对数映射获得它的李代数</span></span><br><span class="line">  Vector3d so3 = SO3_R.<span class="built_in">log</span>();</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"so3 = "</span> &lt;&lt; so3.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// hat 为向量到反对称矩阵</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"so3 hat=\n"</span> &lt;&lt; Sophus::SO3d::hat(so3) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// 相对的，vee为反对称到向量</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"so3 hat vee= "</span> &lt;&lt; Sophus::SO3d::vee(Sophus::SO3d::hat(so3)).transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 增量扰动模型的更新</span></span><br><span class="line">  <span class="function">Vector3d <span class="title">update_so3</span><span class="params">(<span class="number">1e-4</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>; <span class="comment">//假设更新量为这么多</span></span><br><span class="line">  Sophus::SO3d SO3_updated = Sophus::SO3d::<span class="built_in">exp</span>(update_so3) * SO3_R;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"SO3 updated = \n"</span> &lt;&lt; SO3_updated.matrix() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"*******************************"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// 对SE(3)操作大同小异</span></span><br><span class="line">  <span class="function">Vector3d <span class="title">t</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;           <span class="comment">// 沿X轴平移1</span></span><br><span class="line">  <span class="function">Sophus::SE3d <span class="title">SE3_Rt</span><span class="params">(R, t)</span></span>;           <span class="comment">// 从R,t构造SE(3)</span></span><br><span class="line">  <span class="function">Sophus::SE3d <span class="title">SE3_qt</span><span class="params">(q, t)</span></span>;            <span class="comment">// 从q,t构造SE(3)</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"SE3 from R,t= \n"</span> &lt;&lt; SE3_Rt.matrix() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"SE3 from q,t= \n"</span> &lt;&lt; SE3_qt.matrix() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// 李代数se(3) 是一个六维向量，方便起见先typedef一下</span></span><br><span class="line">  <span class="keyword">typedef</span> Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">6</span>, <span class="number">1</span>&gt; Vector6d;</span><br><span class="line">  Vector6d se3 = SE3_Rt.<span class="built_in">log</span>();</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"se3 = "</span> &lt;&lt; se3.transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// 观察输出，会发现在Sophus中，se(3)的平移在前，旋转在后.</span></span><br><span class="line">  <span class="comment">// 同样的，有hat和vee两个算符</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"se3 hat = \n"</span> &lt;&lt; Sophus::SE3d::hat(se3) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"se3 hat vee = "</span> &lt;&lt; Sophus::SE3d::vee(Sophus::SE3d::hat(se3)).transpose() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最后，演示一下更新</span></span><br><span class="line">  Vector6d update_se3; <span class="comment">//更新量</span></span><br><span class="line">  update_se3.setZero();</span><br><span class="line">  update_se3(<span class="number">0</span>, <span class="number">0</span>) = <span class="number">1e-4</span>d;</span><br><span class="line">  Sophus::SE3d SE3_updated = Sophus::SE3d::<span class="built_in">exp</span>(update_se3) * SE3_Rt;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"SE3 updated = "</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; SE3_updated.matrix() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="trajectoryError"><a href="#trajectoryError" class="headerlink" title="trajectoryError"></a>trajectoryError</h2><p>计算估计位姿和真值之间的误差。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pangolin/pangolin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sophus/se3.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Sophus;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> groundtruth_file = <span class="string">"../../example/groundtruth.txt"</span>;</span><br><span class="line"><span class="built_in">string</span> estimated_file = <span class="string">"../../example/estimated.txt"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;Sophus::SE3d, Eigen::aligned_allocator&lt;Sophus::SE3d&gt;&gt; TrajectoryType;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DrawTrajectory</span><span class="params">(<span class="keyword">const</span> TrajectoryType &amp;gt, <span class="keyword">const</span> TrajectoryType &amp;esti)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">TrajectoryType <span class="title">ReadTrajectory</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;path)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  TrajectoryType groundtruth = ReadTrajectory(groundtruth_file);</span><br><span class="line">  TrajectoryType estimated = ReadTrajectory(estimated_file);</span><br><span class="line">  assert(!groundtruth.empty() &amp;&amp; !estimated.empty());</span><br><span class="line">  assert(groundtruth.size() == estimated.size());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// compute rmse</span></span><br><span class="line">  <span class="keyword">double</span> rmse = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; estimated.size(); i++) &#123;</span><br><span class="line">    Sophus::SE3d p1 = estimated[i], p2 = groundtruth[i];</span><br><span class="line">    <span class="keyword">double</span> error = (p2.inverse() * p1).<span class="built_in">log</span>().norm();</span><br><span class="line">    rmse += error * error;</span><br><span class="line">  &#125;</span><br><span class="line">  rmse = rmse / <span class="keyword">double</span>(estimated.size());</span><br><span class="line">  rmse = <span class="built_in">sqrt</span>(rmse);</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"RMSE = "</span> &lt;&lt; rmse &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  DrawTrajectory(groundtruth, estimated);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">TrajectoryType <span class="title">ReadTrajectory</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;path)</span> </span>&#123;</span><br><span class="line">  <span class="function">ifstream <span class="title">fin</span><span class="params">(path)</span></span>;</span><br><span class="line">  TrajectoryType trajectory;</span><br><span class="line">  <span class="keyword">if</span> (!fin) &#123;</span><br><span class="line">    <span class="built_in">cerr</span> &lt;&lt; <span class="string">"trajectory "</span> &lt;&lt; path &lt;&lt; <span class="string">" not found."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> trajectory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!fin.eof()) &#123;</span><br><span class="line">    <span class="keyword">double</span> time, tx, ty, tz, qx, qy, qz, qw;</span><br><span class="line">    fin &gt;&gt; time &gt;&gt; tx &gt;&gt; ty &gt;&gt; tz &gt;&gt; qx &gt;&gt; qy &gt;&gt; qz &gt;&gt; qw;</span><br><span class="line">    <span class="function">Sophus::SE3d <span class="title">p1</span><span class="params">(Eigen::Quaterniond(qx, qy, qz, qw), Eigen::Vector3d(tx, ty, tz))</span></span>;</span><br><span class="line">    trajectory.push_back(p1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> trajectory;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DrawTrajectory</span><span class="params">(<span class="keyword">const</span> TrajectoryType &amp;gt, <span class="keyword">const</span> TrajectoryType &amp;esti)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// create pangolin window and plot the trajectory</span></span><br><span class="line">  pangolin::CreateWindowAndBind(<span class="string">"Trajectory Viewer"</span>, <span class="number">1024</span>, <span class="number">768</span>);</span><br><span class="line">  glEnable(GL_DEPTH_TEST);</span><br><span class="line">  glEnable(GL_BLEND);</span><br><span class="line">  glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">  <span class="function">pangolin::OpenGlRenderState <span class="title">s_cam</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      pangolin::ProjectionMatrix(<span class="number">1024</span>, <span class="number">768</span>, <span class="number">500</span>, <span class="number">500</span>, <span class="number">512</span>, <span class="number">389</span>, <span class="number">0.1</span>, <span class="number">1000</span>),</span></span></span><br><span class="line"><span class="function"><span class="params">      pangolin::ModelViewLookAt(<span class="number">0</span>, <span class="number">-0.1</span>, <span class="number">-1.8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  )</span></span>;</span><br><span class="line"></span><br><span class="line">  pangolin::View &amp;d_cam = pangolin::CreateDisplay()</span><br><span class="line">      .SetBounds(<span class="number">0.0</span>, <span class="number">1.0</span>, pangolin::Attach::Pix(<span class="number">175</span>), <span class="number">1.0</span>, <span class="number">-1024.0f</span> / <span class="number">768.0f</span>)</span><br><span class="line">      .SetHandler(<span class="keyword">new</span> pangolin::Handler3D(s_cam));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (pangolin::ShouldQuit() == <span class="literal">false</span>) &#123;</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    d_cam.Activate(s_cam);</span><br><span class="line">    glClearColor(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">    glLineWidth(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; gt.size() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">      glColor3f(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);  <span class="comment">// blue for ground truth</span></span><br><span class="line">      glBegin(GL_LINES);</span><br><span class="line">      <span class="keyword">auto</span> p1 = gt[i], p2 = gt[i + <span class="number">1</span>];</span><br><span class="line">      glVertex3d(p1.translation()[<span class="number">0</span>], p1.translation()[<span class="number">1</span>], p1.translation()[<span class="number">2</span>]);</span><br><span class="line">      glVertex3d(p2.translation()[<span class="number">0</span>], p2.translation()[<span class="number">1</span>], p2.translation()[<span class="number">2</span>]);</span><br><span class="line">      glEnd();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; esti.size() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">      glColor3f(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);  <span class="comment">// red for estimated</span></span><br><span class="line">      glBegin(GL_LINES);</span><br><span class="line">      <span class="keyword">auto</span> p1 = esti[i], p2 = esti[i + <span class="number">1</span>];</span><br><span class="line">      glVertex3d(p1.translation()[<span class="number">0</span>], p1.translation()[<span class="number">1</span>], p1.translation()[<span class="number">2</span>]);</span><br><span class="line">      glVertex3d(p2.translation()[<span class="number">0</span>], p2.translation()[<span class="number">1</span>], p2.translation()[<span class="number">2</span>]);</span><br><span class="line">      glEnd();</span><br><span class="line">    &#125;</span><br><span class="line">    pangolin::FinishFrame();</span><br><span class="line">    usleep(<span class="number">5000</span>);   <span class="comment">// sleep 5 ms</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="相机与图像"><a href="#相机与图像" class="headerlink" title="相机与图像"></a>相机与图像</h1><h2 id="imageBasics"><a href="#imageBasics" class="headerlink" title="imageBasics"></a>imageBasics</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 读取argv[1]指定的图像</span></span><br><span class="line">  cv::Mat image;</span><br><span class="line">  image = cv::imread(argv[<span class="number">1</span>]); <span class="comment">//cv::imread函数读取指定路径下的图像</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断图像文件是否正确读取</span></span><br><span class="line">  <span class="keyword">if</span> (image.data == <span class="literal">nullptr</span>) &#123; <span class="comment">//数据不存在,可能是文件不存在</span></span><br><span class="line">    <span class="built_in">cerr</span> &lt;&lt; <span class="string">"文件"</span> &lt;&lt; argv[<span class="number">1</span>] &lt;&lt; <span class="string">"不存在."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 文件顺利读取, 首先输出一些基本信息</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"图像宽为"</span> &lt;&lt; image.cols &lt;&lt; <span class="string">",高为"</span> &lt;&lt; image.rows &lt;&lt; <span class="string">",通道数为"</span> &lt;&lt; image.channels() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  cv::imshow(<span class="string">"image"</span>, image);      <span class="comment">// 用cv::imshow显示图像</span></span><br><span class="line">  cv::waitKey(<span class="number">0</span>);                  <span class="comment">// 暂停程序,等待一个按键输入</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断image的类型</span></span><br><span class="line">  <span class="keyword">if</span> (image.type() != CV_8UC1 &amp;&amp; image.type() != CV_8UC3) &#123;</span><br><span class="line">    <span class="comment">// 图像类型不符合要求</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入一张彩色图或灰度图."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历图像, 请注意以下遍历方式亦可使用于随机像素访问</span></span><br><span class="line">  <span class="comment">// 使用 std::chrono 来给算法计时</span></span><br><span class="line">  chrono::steady_clock::time_point t1 = chrono::steady_clock::now();</span><br><span class="line">  <span class="comment">//size_t要么是unsigned int，要么是unsigned long int</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> y = <span class="number">0</span>; y &lt; image.rows; y++) &#123;</span><br><span class="line">    <span class="comment">// 用cv::Mat::ptr获得图像的行指针</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *row_ptr = image.ptr&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt;(y);  <span class="comment">// row_ptr是第y行的头指针</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> x = <span class="number">0</span>; x &lt; image.cols; x++) &#123;</span><br><span class="line">      <span class="comment">// 访问位于 x,y 处的像素</span></span><br><span class="line">      <span class="keyword">unsigned</span> <span class="keyword">char</span> *data_ptr = &amp;row_ptr[x * image.channels()]; <span class="comment">// data_ptr 指向待访问的像素数据</span></span><br><span class="line">      <span class="comment">// 输出该像素的每个通道,如果是灰度图就只有一个通道</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c != image.channels(); c++) &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> data = data_ptr[c]; <span class="comment">// data为I(x,y)第c个通道的值</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  chrono::steady_clock::time_point t2 = chrono::steady_clock::now();</span><br><span class="line">  chrono::duration&lt;<span class="keyword">double</span>&gt; time_used = chrono::duration_cast &lt; chrono::duration &lt; <span class="keyword">double</span> &gt;&gt; (t2 - t1);</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"遍历图像用时："</span> &lt;&lt; time_used.count() &lt;&lt; <span class="string">" 秒。"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关于 cv::Mat 的拷贝</span></span><br><span class="line">  <span class="comment">// 直接赋值并不会拷贝数据</span></span><br><span class="line">  cv::Mat image_another = image;</span><br><span class="line">  <span class="comment">// 修改 image_another 会导致 image 发生变化</span></span><br><span class="line">  image_another(cv::Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)).setTo(<span class="number">0</span>); <span class="comment">// 将左上角100*100的块置零</span></span><br><span class="line">  cv::imshow(<span class="string">"image"</span>, image);</span><br><span class="line">  cv::waitKey(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用clone函数来拷贝数据</span></span><br><span class="line">  cv::Mat image_clone = image.clone();</span><br><span class="line">  image_clone(cv::Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)).setTo(<span class="number">255</span>);</span><br><span class="line">  cv::imshow(<span class="string">"image"</span>, image);</span><br><span class="line">  cv::imshow(<span class="string">"image_clone"</span>, image_clone);</span><br><span class="line">  cv::waitKey(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对于图像还有很多基本的操作,如剪切,旋转,缩放等,限于篇幅就不一一介绍了,请参看OpenCV官方文档查询每个函数的调用方法.</span></span><br><span class="line">  cv::destroyAllWindows();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="undistortImage"><a href="#undistortImage" class="headerlink" title="undistortImage"></a>undistortImage</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> image_file = <span class="string">"./distorted.png"</span>;   <span class="comment">// 请确保路径正确</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 本程序实现去畸变部分的代码。尽管我们可以调用OpenCV的去畸变，但自己实现一遍有助于理解。</span></span><br><span class="line">  <span class="comment">// 畸变参数</span></span><br><span class="line">  <span class="keyword">double</span> k1 = <span class="number">-0.28340811</span>, k2 = <span class="number">0.07395907</span>, p1 = <span class="number">0.00019359</span>, p2 = <span class="number">1.76187114e-05</span>;</span><br><span class="line">  <span class="comment">// 内参</span></span><br><span class="line">  <span class="keyword">double</span> fx = <span class="number">458.654</span>, fy = <span class="number">457.296</span>, cx = <span class="number">367.215</span>, cy = <span class="number">248.375</span>;</span><br><span class="line"></span><br><span class="line">  cv::Mat image = cv::imread(image_file, <span class="number">0</span>);   <span class="comment">// 图像是灰度图，CV_8UC1</span></span><br><span class="line">  <span class="keyword">int</span> rows = image.rows, cols = image.cols;</span><br><span class="line">  cv::Mat image_undistort = cv::Mat(rows, cols, CV_8UC1);   <span class="comment">// 去畸变以后的图</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 计算去畸变后图像的内容</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">0</span>; v &lt; rows; v++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">0</span>; u &lt; cols; u++) &#123;</span><br><span class="line">      <span class="comment">// 按照公式，计算点(u,v)对应到畸变图像中的坐标(u_distorted, v_distorted)</span></span><br><span class="line">      <span class="keyword">double</span> x = (u - cx) / fx, y = (v - cy) / fy;</span><br><span class="line">      <span class="keyword">double</span> r = <span class="built_in">sqrt</span>(x * x + y * y);</span><br><span class="line">      <span class="keyword">double</span> x_distorted = x * (<span class="number">1</span> + k1 * r * r + k2 * r * r * r * r) + <span class="number">2</span> * p1 * x * y + p2 * (r * r + <span class="number">2</span> * x * x);</span><br><span class="line">      <span class="keyword">double</span> y_distorted = y * (<span class="number">1</span> + k1 * r * r + k2 * r * r * r * r) + p1 * (r * r + <span class="number">2</span> * y * y) + <span class="number">2</span> * p2 * x * y;</span><br><span class="line">      <span class="keyword">double</span> u_distorted = fx * x_distorted + cx;</span><br><span class="line">      <span class="keyword">double</span> v_distorted = fy * y_distorted + cy;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 赋值 (最近邻插值)</span></span><br><span class="line">      <span class="keyword">if</span> (u_distorted &gt;= <span class="number">0</span> &amp;&amp; v_distorted &gt;= <span class="number">0</span> &amp;&amp; u_distorted &lt; cols &amp;&amp; v_distorted &lt; rows) &#123;</span><br><span class="line">        image_undistort.at&lt;uchar&gt;(v, u) = image.at&lt;uchar&gt;((<span class="keyword">int</span>) v_distorted, (<span class="keyword">int</span>) u_distorted);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        image_undistort.at&lt;uchar&gt;(v, u) = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画图去畸变后图像</span></span><br><span class="line">  cv::imshow(<span class="string">"distorted"</span>, image);</span><br><span class="line">  cv::imshow(<span class="string">"undistorted"</span>, image_undistort);</span><br><span class="line">  cv::waitKey();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="stereoVision"><a href="#stereoVision" class="headerlink" title="stereoVision"></a>stereoVision</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pangolin/pangolin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件路径</span></span><br><span class="line"><span class="built_in">string</span> left_file = <span class="string">"./left.png"</span>;</span><br><span class="line"><span class="built_in">string</span> right_file = <span class="string">"./right.png"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在pangolin中画图，已写好，无需调整</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showPointCloud</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> <span class="built_in">vector</span>&lt;Vector4d, Eigen::aligned_allocator&lt;Vector4d&gt;&gt; &amp;pointcloud)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内参</span></span><br><span class="line">    <span class="keyword">double</span> fx = <span class="number">718.856</span>, fy = <span class="number">718.856</span>, cx = <span class="number">607.1928</span>, cy = <span class="number">185.2157</span>;</span><br><span class="line">    <span class="comment">// 基线</span></span><br><span class="line">    <span class="keyword">double</span> b = <span class="number">0.573</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取图像</span></span><br><span class="line">    cv::Mat left = cv::imread(left_file, <span class="number">0</span>);</span><br><span class="line">    cv::Mat right = cv::imread(right_file, <span class="number">0</span>);</span><br><span class="line">    cv::Ptr&lt;cv::StereoSGBM&gt; sgbm = cv::StereoSGBM::create(</span><br><span class="line">        <span class="number">0</span>, <span class="number">96</span>, <span class="number">9</span>, <span class="number">8</span> * <span class="number">9</span> * <span class="number">9</span>, <span class="number">32</span> * <span class="number">9</span> * <span class="number">9</span>, <span class="number">1</span>, <span class="number">63</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">32</span>);    <span class="comment">// 神奇的参数</span></span><br><span class="line">    cv::Mat disparity_sgbm, disparity;</span><br><span class="line">    sgbm-&gt;compute(left, right, disparity_sgbm);</span><br><span class="line">    disparity_sgbm.convertTo(disparity, CV_32F, <span class="number">1.0</span> / <span class="number">16.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成点云</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;Vector4d, Eigen::aligned_allocator&lt;Vector4d&gt;&gt; pointcloud;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果你的机器慢，请把后面的v++和u++改成v+=2, u+=2</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">0</span>; v &lt; left.rows; v++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">0</span>; u &lt; left.cols; u++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (disparity.at&lt;<span class="keyword">float</span>&gt;(v, u) &lt;= <span class="number">0.0</span> || disparity.at&lt;<span class="keyword">float</span>&gt;(v, u) &gt;= <span class="number">96.0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function">Vector4d <span class="title">point</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, left.at&lt;uchar&gt;(v, u) / <span class="number">255.0</span>)</span></span>; <span class="comment">// 前三维为xyz,第四维为颜色</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 根据双目模型计算 point 的位置</span></span><br><span class="line">            <span class="keyword">double</span> x = (u - cx) / fx;</span><br><span class="line">            <span class="keyword">double</span> y = (v - cy) / fy;</span><br><span class="line">            <span class="keyword">double</span> depth = fx * b / (disparity.at&lt;<span class="keyword">float</span>&gt;(v, u));</span><br><span class="line">            point[<span class="number">0</span>] = x * depth;</span><br><span class="line">            point[<span class="number">1</span>] = y * depth;</span><br><span class="line">            point[<span class="number">2</span>] = depth;</span><br><span class="line"></span><br><span class="line">            pointcloud.push_back(point);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    cv::imshow(<span class="string">"disparity"</span>, disparity / <span class="number">96.0</span>);</span><br><span class="line">    cv::waitKey(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 画出点云</span></span><br><span class="line">    showPointCloud(pointcloud);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showPointCloud</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;Vector4d, Eigen::aligned_allocator&lt;Vector4d&gt;&gt; &amp;pointcloud)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pointcloud.empty()) &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; <span class="string">"Point cloud is empty!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pangolin::CreateWindowAndBind(<span class="string">"Point Cloud Viewer"</span>, <span class="number">1024</span>, <span class="number">768</span>);</span><br><span class="line">    glEnable(GL_DEPTH_TEST);</span><br><span class="line">    glEnable(GL_BLEND);</span><br><span class="line">    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">    <span class="function">pangolin::OpenGlRenderState <span class="title">s_cam</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        pangolin::ProjectionMatrix(<span class="number">1024</span>, <span class="number">768</span>, <span class="number">500</span>, <span class="number">500</span>, <span class="number">512</span>, <span class="number">389</span>, <span class="number">0.1</span>, <span class="number">1000</span>),</span></span></span><br><span class="line"><span class="function"><span class="params">        pangolin::ModelViewLookAt(<span class="number">0</span>, <span class="number">-0.1</span>, <span class="number">-1.8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>;</span><br><span class="line"></span><br><span class="line">    pangolin::View &amp;d_cam = pangolin::CreateDisplay()</span><br><span class="line">        .SetBounds(<span class="number">0.0</span>, <span class="number">1.0</span>, pangolin::Attach::Pix(<span class="number">175</span>), <span class="number">1.0</span>, <span class="number">-1024.0f</span> / <span class="number">768.0f</span>)</span><br><span class="line">        .SetHandler(<span class="keyword">new</span> pangolin::Handler3D(s_cam));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (pangolin::ShouldQuit() == <span class="literal">false</span>) &#123;</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        d_cam.Activate(s_cam);</span><br><span class="line">        glClearColor(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">        glPointSize(<span class="number">2</span>);</span><br><span class="line">        glBegin(GL_POINTS);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;p: pointcloud) &#123;</span><br><span class="line">            glColor3f(p[<span class="number">3</span>], p[<span class="number">3</span>], p[<span class="number">3</span>]);</span><br><span class="line">            glVertex3d(p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        glEnd();</span><br><span class="line">        pangolin::FinishFrame();</span><br><span class="line">        usleep(<span class="number">5000</span>);   <span class="comment">// sleep 5 ms</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h2 id="JoinMap-拼接点云）"><a href="#JoinMap-拼接点云）" class="headerlink" title="JoinMap (拼接点云）"></a>JoinMap (拼接点云）</h2><p>完成两件事：<br>(1). 根据内参计算一对 RGB-D 图像对应的点云；<br>(2). 根据各张图的相机位姿（也就是外参），把点云加起来，组成地图。<br>点云库使用 PCL（Point Cloud Library）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/format.hpp&gt;  // for formating strings</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sophus/se3.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pangolin/pangolin.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;Sophus::SE3d, Eigen::aligned_allocator&lt;Sophus::SE3d&gt;&gt; TrajectoryType;</span><br><span class="line"><span class="keyword">typedef</span> Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">6</span>, <span class="number">1</span>&gt; Vector6d;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在pangolin中画图，已写好，无需调整</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showPointCloud</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> <span class="built_in">vector</span>&lt;Vector6d, Eigen::aligned_allocator&lt;Vector6d&gt;&gt; &amp;pointcloud)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;cv::Mat&gt; colorImgs, depthImgs;    <span class="comment">// 彩色图和深度图</span></span><br><span class="line">    TrajectoryType poses;         <span class="comment">// 相机位姿</span></span><br><span class="line"></span><br><span class="line">    <span class="function">ifstream <span class="title">fin</span><span class="params">(<span class="string">"./pose.txt"</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!fin) &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; <span class="string">"请在有pose.txt的目录下运行此程序"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="function">boost::format <span class="title">fmt</span><span class="params">(<span class="string">"./%s/%d.%s"</span>)</span></span>; <span class="comment">//图像文件格式</span></span><br><span class="line">        colorImgs.push_back(cv::imread((fmt % <span class="string">"color"</span> % (i + <span class="number">1</span>) % <span class="string">"png"</span>).str()));</span><br><span class="line">        depthImgs.push_back(cv::imread((fmt % <span class="string">"depth"</span> % (i + <span class="number">1</span>) % <span class="string">"pgm"</span>).str(), <span class="number">-1</span>)); <span class="comment">// 使用-1读取原始图像</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span> data[<span class="number">7</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="comment">//for(auto a:b)中b为一个容器，效果是利用a遍历并获得b容器中的每一个值，但是a无法影响到b容器中的元素。</span></span><br><span class="line">    	<span class="comment">//for(auto &amp;a:b)中加了引用符号，可以对容器中的内容进行赋值，即可通过对a赋值来做到容器b的内容填充。</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;d:data)</span><br><span class="line">            fin &gt;&gt; d;</span><br><span class="line">        <span class="function">Sophus::SE3d <span class="title">pose</span><span class="params">(Eigen::Quaterniond(data[<span class="number">6</span>], data[<span class="number">3</span>], data[<span class="number">4</span>], data[<span class="number">5</span>]),</span></span></span><br><span class="line"><span class="function"><span class="params">                          Eigen::Vector3d(data[<span class="number">0</span>], data[<span class="number">1</span>], data[<span class="number">2</span>]))</span></span>;</span><br><span class="line">        poses.push_back(pose);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算点云并拼接</span></span><br><span class="line">    <span class="comment">// 相机内参 </span></span><br><span class="line">    <span class="keyword">double</span> cx = <span class="number">325.5</span>;</span><br><span class="line">    <span class="keyword">double</span> cy = <span class="number">253.5</span>;</span><br><span class="line">    <span class="keyword">double</span> fx = <span class="number">518.0</span>;</span><br><span class="line">    <span class="keyword">double</span> fy = <span class="number">519.0</span>;</span><br><span class="line">    <span class="keyword">double</span> depthScale = <span class="number">1000.0</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;Vector6d, Eigen::aligned_allocator&lt;Vector6d&gt;&gt; pointcloud;</span><br><span class="line">    pointcloud.reserve(<span class="number">1000000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"转换图像中: "</span> &lt;&lt; i + <span class="number">1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        cv::Mat color = colorImgs[i];</span><br><span class="line">        cv::Mat depth = depthImgs[i];</span><br><span class="line">        Sophus::SE3d T = poses[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">0</span>; v &lt; color.rows; v++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">0</span>; u &lt; color.cols; u++) &#123;</span><br><span class="line">                <span class="keyword">unsigned</span> <span class="keyword">int</span> d = depth.ptr&lt;<span class="keyword">unsigned</span> short&gt;(v)[u]; <span class="comment">// 深度值</span></span><br><span class="line">                <span class="keyword">if</span> (d == <span class="number">0</span>) <span class="keyword">continue</span>; <span class="comment">// 为0表示没有测量到</span></span><br><span class="line">                Eigen::Vector3d point;</span><br><span class="line">                point[<span class="number">2</span>] = <span class="keyword">double</span>(d) / depthScale;</span><br><span class="line">                point[<span class="number">0</span>] = (u - cx) * point[<span class="number">2</span>] / fx;</span><br><span class="line">                point[<span class="number">1</span>] = (v - cy) * point[<span class="number">2</span>] / fy;</span><br><span class="line">                Eigen::Vector3d pointWorld = T * point;</span><br><span class="line"></span><br><span class="line">                Vector6d p;</span><br><span class="line">                p.head&lt;<span class="number">3</span>&gt;() = pointWorld;</span><br><span class="line">                p[<span class="number">5</span>] = color.data[v * color.step + u * color.channels()];   <span class="comment">// blue</span></span><br><span class="line">                p[<span class="number">4</span>] = color.data[v * color.step + u * color.channels() + <span class="number">1</span>]; <span class="comment">// green</span></span><br><span class="line">                p[<span class="number">3</span>] = color.data[v * color.step + u * color.channels() + <span class="number">2</span>]; <span class="comment">// red</span></span><br><span class="line">                pointcloud.push_back(p);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"点云共有"</span> &lt;&lt; pointcloud.size() &lt;&lt; <span class="string">"个点."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    showPointCloud(pointcloud);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showPointCloud</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;Vector6d, Eigen::aligned_allocator&lt;Vector6d&gt;&gt; &amp;pointcloud)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pointcloud.empty()) &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; <span class="string">"Point cloud is empty!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pangolin::CreateWindowAndBind(<span class="string">"Point Cloud Viewer"</span>, <span class="number">1024</span>, <span class="number">768</span>);</span><br><span class="line">    glEnable(GL_DEPTH_TEST);</span><br><span class="line">    glEnable(GL_BLEND);</span><br><span class="line">    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">    <span class="function">pangolin::OpenGlRenderState <span class="title">s_cam</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        pangolin::ProjectionMatrix(<span class="number">1024</span>, <span class="number">768</span>, <span class="number">500</span>, <span class="number">500</span>, <span class="number">512</span>, <span class="number">389</span>, <span class="number">0.1</span>, <span class="number">1000</span>),</span></span></span><br><span class="line"><span class="function"><span class="params">        pangolin::ModelViewLookAt(<span class="number">0</span>, <span class="number">-0.1</span>, <span class="number">-1.8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>;</span><br><span class="line"></span><br><span class="line">    pangolin::View &amp;d_cam = pangolin::CreateDisplay()</span><br><span class="line">        .SetBounds(<span class="number">0.0</span>, <span class="number">1.0</span>, pangolin::Attach::Pix(<span class="number">175</span>), <span class="number">1.0</span>, <span class="number">-1024.0f</span> / <span class="number">768.0f</span>)</span><br><span class="line">        .SetHandler(<span class="keyword">new</span> pangolin::Handler3D(s_cam));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (pangolin::ShouldQuit() == <span class="literal">false</span>) &#123;</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        d_cam.Activate(s_cam);</span><br><span class="line">        glClearColor(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">        glPointSize(<span class="number">2</span>);</span><br><span class="line">        glBegin(GL_POINTS);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;p: pointcloud) &#123;</span><br><span class="line">            glColor3d(p[<span class="number">3</span>] / <span class="number">255.0</span>, p[<span class="number">4</span>] / <span class="number">255.0</span>, p[<span class="number">5</span>] / <span class="number">255.0</span>);</span><br><span class="line">            glVertex3d(p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        glEnd();</span><br><span class="line">        pangolin::FinishFrame();</span><br><span class="line">        usleep(<span class="number">5000</span>);   <span class="comment">// sleep 5 ms</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;cv::Mat&gt; colorImgs, depthImgs;    <span class="comment">// 彩色图和深度图</span></span><br><span class="line"><span class="built_in">vector</span>&lt;Eigen::Isometry3d, Eigen::aligned_allocator&lt;Eigen::Isometry3d&gt;&gt; poses;         <span class="comment">// 相机位姿,由4x4的变换矩阵T组成的容器</span></span><br><span class="line"></span><br><span class="line"><span class="function">ifstream <span class="title">fin</span><span class="params">(<span class="string">"./pose.txt"</span>)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (!fin)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cerr</span>&lt;&lt;<span class="string">"请在有pose.txt的目录下运行此程序"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">boost::format <span class="title">fmt</span><span class="params">( <span class="string">"./%s/%d.%s"</span> )</span></span>; <span class="comment">//图像文件格式,（./字符串/整数.字符串）</span></span><br><span class="line">    colorImgs.push_back( cv::imread( (fmt%<span class="string">"color"</span>%(i+<span class="number">1</span>)%<span class="string">"png"</span>).str() ));<span class="comment">//cv::imread(./color/1.png)</span></span><br><span class="line">    depthImgs.push_back( cv::imread( (fmt%<span class="string">"depth"</span>%(i+<span class="number">1</span>)%<span class="string">"pgm"</span>).str(), <span class="number">-1</span> )); <span class="comment">// 使用-1读取原始图像</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">double</span> data[<span class="number">7</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="keyword">auto</span>&amp; d:data )<span class="comment">//for(auto a:b)中b为一个容器，效果是利用a遍历并获得b容器中的每一个值，但是a无法影响到b容器中的元素。</span></span><br><span class="line">    					<span class="comment">//for(auto &amp;a:b)中加了引用符号，可以对容器中的内容进行赋值，即可通过对a赋值来做到容器b的内容填充。</span></span><br><span class="line">        fin&gt;&gt;d;</span><br><span class="line">    <span class="function">Eigen::Quaterniond <span class="title">q</span><span class="params">( data[<span class="number">6</span>], data[<span class="number">3</span>], data[<span class="number">4</span>], data[<span class="number">5</span>] )</span></span>;</span><br><span class="line">    <span class="function">Eigen::Isometry3d <span class="title">T</span><span class="params">(q)</span></span>;</span><br><span class="line">    T.pretranslate( Eigen::Vector3d( data[<span class="number">0</span>], data[<span class="number">1</span>], data[<span class="number">2</span>] ));</span><br><span class="line">    poses.push_back( T );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/20/C++%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" rel="prev" title="C++基础入门">
      <i class="fa fa-chevron-left"></i> C++基础入门
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/04/05/PS%20%E6%8A%A0%E4%BA%BA%E5%83%8F%E6%96%B9%E6%B3%95/" rel="next" title="PS 抠人像方法">
      PS 抠人像方法 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#CMakeLists-txt常用语法："><span class="nav-number">1.</span> <span class="nav-text">CMakeLists.txt常用语法：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#初识SLAM"><span class="nav-number">2.</span> <span class="nav-text">初识SLAM</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#g-的使用"><span class="nav-number">2.1.</span> <span class="nav-text">g++的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cmake的使用方法："><span class="nav-number">2.2.</span> <span class="nav-text">cmake的使用方法：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三维空间刚体运动"><span class="nav-number">3.</span> <span class="nav-text">三维空间刚体运动</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#eigenMatrix"><span class="nav-number">3.1.</span> <span class="nav-text">eigenMatrix</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#eigenGeometry"><span class="nav-number">3.2.</span> <span class="nav-text">eigenGeometry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#visualizeGeometry"><span class="nav-number">3.3.</span> <span class="nav-text">visualizeGeometry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#coordinaeTransform"><span class="nav-number">3.4.</span> <span class="nav-text">coordinaeTransform</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plotTrajectory"><span class="nav-number">3.5.</span> <span class="nav-text">plotTrajectory</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#李群、李代数"><span class="nav-number">4.</span> <span class="nav-text">李群、李代数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#useSophus"><span class="nav-number">4.1.</span> <span class="nav-text">useSophus</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#trajectoryError"><span class="nav-number">4.2.</span> <span class="nav-text">trajectoryError</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#相机与图像"><span class="nav-number">5.</span> <span class="nav-text">相机与图像</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#imageBasics"><span class="nav-number">5.1.</span> <span class="nav-text">imageBasics</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undistortImage"><span class="nav-number">5.2.</span> <span class="nav-text">undistortImage</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#stereoVision"><span class="nav-number">5.3.</span> <span class="nav-text">stereoVision</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JoinMap-拼接点云）"><span class="nav-number">5.4.</span> <span class="nav-text">JoinMap (拼接点云）</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jeff Tian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeff Tian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.2
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
